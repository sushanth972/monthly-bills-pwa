<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-title" content="MonthlyBills">
    <title>MonthlyBills - Monthly Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Monthly Bills PWA App Logic
        class MonthlyBillsApp {
            constructor() {
                this.expenses = JSON.parse(localStorage.getItem('monthly_expenses') || '[]');
                this.render();
                this.setupEventListeners();
            }

            render() {
                const root = document.getElementById('root');
                
                const totalMonthly = this.expenses.reduce((a, b) => a + b.amount, 0);
                const totalPaid = this.expenses.reduce((a, b) => {
                    const now = new Date();
                    const currentKey = `${now.getFullYear()}-${now.getMonth()}`;
                    return (b.paidHistory && b.paidHistory.includes(currentKey)) ? a + b.amount : a;
                }, 0);
                const totalPending = totalMonthly - totalPaid;

                root.innerHTML = `
                    <div class="min-h-screen bg-gray-50 pb-20">
                        <!-- Header -->
                        <header class="bg-indigo-600 text-white p-6 pb-12 rounded-b-[2rem] shadow-lg">
                            <div class="flex justify-between items-center mb-6">
                                <h1 class="text-2xl font-bold">üìÖ MonthlyBills</h1>
                                <div class="flex gap-2">
                                    <button onclick="app.showDataModal()" class="p-2 rounded-full bg-indigo-500 text-indigo-200 hover:bg-indigo-700">
                                        üíæ
                                    </button>
                                    <button onclick="app.requestNotification()" class="p-2 rounded-full bg-white text-indigo-600">
                                        üîî
                                    </button>
                                </div>
                            </div>
                            <div class="flex justify-between items-end">
                                <div>
                                    <p class="text-indigo-200 text-sm font-medium mb-1">Left to Pay</p>
                                    <p class="text-4xl font-bold">‚Çπ${totalPending.toLocaleString()}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-indigo-200 text-xs mb-1">Total Budget</p>
                                    <p class="font-semibold">‚Çπ${totalMonthly.toLocaleString()}</p>
                                </div>
                            </div>
                        </header>

                        <!-- Stats -->
                        <div class="px-6 -mt-8 grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <span class="text-xs text-gray-400 font-bold">Paid</span>
                                <span class="text-xl font-bold text-green-600">‚Çπ${totalPaid.toLocaleString()}</span>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <span class="text-xs text-gray-400 font-bold">Progress</span>
                                <span class="text-xl font-bold text-indigo-600">${totalMonthly > 0 ? Math.round((totalPaid / totalMonthly) * 100) : 0}%</span>
                            </div>
                        </div>

                        <!-- Bills List -->
                        <div class="px-4 space-y-3">
                            <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider px-2">Your Bills</h2>
                            ${this.expenses.length === 0 ? '<div class="text-center py-10 text-gray-400"><p>No expenses yet. Tap + to add one.</p></div>' : ''}
                            ${this.expenses.map((exp, idx) => this.renderExpenseItem(exp, idx)).join('')}
                        </div>

                        <!-- FAB -->
                        <button onclick="app.showAddModal()" class="fixed bottom-6 right-6 bg-indigo-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-indigo-700 text-2xl">
                            ‚ûï
                        </button>

                        <!-- Add Expense Modal -->
                        <div id="addModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 p-4">
                            <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl">
                                <h2 class="text-xl font-bold text-gray-800 mb-6">Add New Bill</h2>
                                <form onsubmit="app.addExpense(event)">
                                    <input type="text" id="expenseName" placeholder="e.g., Rent, Netflix" class="w-full p-3 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-500 mb-4" required>
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <input type="number" id="expenseAmount" placeholder="0.00" class="w-full p-3 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-500" required>
                                        <input type="date" id="expenseDate" class="w-full p-3 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-indigo-500" required>
                                    </div>
                                    <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl hover:bg-indigo-700">Save Expense</button>
                                </form>
                                <button onclick="app.closeModal('addModal')" class="mt-2 w-full text-gray-600 py-2">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderExpenseItem(exp, idx) {
                const now = new Date();
                const currentKey = `${now.getFullYear()}-${now.getMonth()}`;
                const isPaid = exp.paidHistory && exp.paidHistory.includes(currentKey);
                
                return `
                    <div class="flex items-center justify-between p-4 rounded-xl border shadow-sm bg-white">
                        <div class="flex items-center gap-4 flex-1">
                            <button onclick="app.togglePaid(${idx})" class="text-2xl">
                                ${isPaid ? '‚úÖ' : '‚≠ï'}
                            </button>
                            <div>
                                <h3 class="font-semibold ${isPaid ? 'text-gray-400 line-through' : 'text-gray-800'}">${exp.name}</h3>
                                <p class="text-xs ${isPaid ? 'text-gray-400' : 'text-indigo-600'} font-medium">Due: ${exp.dueDay}th</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-bold ${isPaid ? 'text-gray-400' : 'text-gray-800'}">‚Çπ${exp.amount}</span>
                            <button onclick="app.deleteExpense(${idx})" class="text-gray-300 hover:text-red-400">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }

            togglePaid(idx) {
                const now = new Date();
                const currentKey = `${now.getFullYear()}-${now.getMonth()}`;
                if (!this.expenses[idx].paidHistory) this.expenses[idx].paidHistory = [];
                
                const history = this.expenses[idx].paidHistory;
                if (history.includes(currentKey)) {
                    history.splice(history.indexOf(currentKey), 1);
                } else {
                    history.push(currentKey);
                }
                
                this.save();
            }

            deleteExpense(idx) {
                if (confirm('Delete this expense?')) {
                    this.expenses.splice(idx, 1);
                    this.save();
                }
            }

            addExpense(e) {
                e.preventDefault();
                const name = document.getElementById('expenseName').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const dateInput = document.getElementById('expenseDate').value;
                const dueDay = parseInt(dateInput.split('-')[2]);

                this.expenses.push({
                    id: Date.now(),
                    name,
                    amount,
                    dueDay,
                    remind: true,
                    isRecurring: true,
                    paidHistory: []
                });

                this.closeModal('addModal');
                this.save();
            }

            showAddModal() {
                document.getElementById('addModal').classList.remove('hidden');
                document.getElementById('expenseName').focus();
            }

            showDataModal() {
                const dataUrl = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(this.expenses, null, 2));
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `MonthlyBills_${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
            }

            requestNotification() {
                if ('Notification' in window) {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('MonthlyBills', { body: 'Reminders enabled!' });
                        }
                    });
                }
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.add('hidden');
            }

            save() {
                localStorage.setItem('monthly_expenses', JSON.stringify(this.expenses));
                this.render();
            }

            setupEventListeners() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('close-modal')) {
                        this.closeModal('addModal');
                    }
                });
            }
        }

        const app = new MonthlyBillsApp();
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,console.log("offline support")');
        }
    </script>
</body>
</html>
